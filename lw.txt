http://www.woshipm.com/it/3474128.html

http://www.woshipm.com/pd/408632.html

https://zhuanlan.zhihu.com/p/123148265

https://www.jianshu.com/p/4d9120dfcd69

http://www.upyun.com/tech/article/377/%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD%E4%BD%8E%E5%BB%B6%E8%BF%9F%E7%9A%84%E5%87%A0%E4%B8%AA%E7%AA%8D%E9%97%A8.html





直播技术在电商业务中应用和研究

（1）中文摘要


直播为传统电商提供了一个全新的商品“社交”营销模式——主播将有相同爱好的观众聚集在直播间中，观众在电商直播平台上观看主播播出的内容时，就可以通过点击直播间上显示的链接直接购买产品。同时，这些观众还能够在直播间中发表自己对商品的意见和看法，或者根据自己的需求让主播推荐适合自己的商品。

这种“直播+电商”的模式，不仅提升了互联网中消费者的黏性，而且提高了电商的商品销售转化率，为传统电商创造了一次更大的盈利机会，让电商平台吸纳互联网中的流量，并将这些流量最大限度地变现。

电商平台镶嵌直播功能其实已经被许多电商界顶级企业应用。比如，淘宝、京东等，这些都是电商在自己的平台中镶嵌相应的直播功能，相当于把直播变成电商的“附属品”。在电商平台镶嵌直播功能的模式下，一开始主要是利用电商平台的流量带动直播流量，等直播平台拥有充足的固定流量之后，再利用直播流量反哺电商。

采用这种模式的电商，多数偏向于利用网红、明星等推广一些性价比高、价格能够被大多数消费者接受的“大众消费品”，在短时间内达到促销的目的。如果直播营销的效果足够好，甚至可以让一些“平价”商品脱销。

这种会在短时间达到“促销效果”的“直播+电商”模式，可以被大多数喜欢网购的年轻人所接受，并且能让这些年轻人在观看直播的时候潜意识地接受商品，并产生购买的想法。所以，是目前大多数电商平台最喜欢用的模式。


------------------------------------------------------------------------------------------

引言：
2020开年的疫情对传统行业影响很大，服装实体店形势也不容乐观。在这种情况下，电商直播凭借线上平台的优势，仍然在蓬勃发展中。

根据《2020电商增长驱动力》行业报告发布，人们的消费观发生了新的变化，私域流量得到更多的重视。
直播电商，指的是那些在电商App中植入店家直播售卖场景的一种电商新形势，电商主播们会用他们专业的眼光以及诱发人们购买欲的辞藻，去介绍一件又一件商品。当然，你也可以直白的理解成——手机里的电视购物。
淘宝从2016年开启“淘宝直播”之后，新一轮的网红经济就又被触发了新窗口，如今，直播电商风生水起，官方数据显示，2018年淘宝直播平台带货达千亿，实现了跨越式的发展。

“以直播为代表的内容化战略，已经成为淘宝增长的核心驱动力，不但成为商家运营的核心工具，也带来更多的用户时长和用户成交，今天淘宝的很多行业，很多业务，很多用户的增长，都来自于直播这一新模式。”


------------------------------------------------------------------------------------------


（2）电商直播概述
（2.1）电商直播概念和特点

概述：

视频直播服务（ApsaraVideo Live）是基于内容接入、分发网络和大规模分布式实时转码技术打造的音视频直播平台，提供便捷接入、高清流畅、低延迟、高并发的音视频直播服务。
您可以通过 视频直播控制台、API 和 SDK 使用、管理视频直播服务，也可以与您自己的应用和服务集成。


优势：
1、客户体验的角度
直播可以直观地看到商品以及主播亲测，帮用户解决很多看不见摸不着的问题

2、效率的角度
直播改变了电商从打版、拍照、上架、售卖的流程，“前播后厂”的直播供应链模式，带来了效率上的提升。

3、成本角度
网络直播能够实现更具轻量化、更高互动性、创新性、快速销售等特点


（2.2）电商直播技术及内容

工作原理：

通过采集设备将直播流推送至直播中心，推送的视频流通过CDN边缘节点进行加速保证上行传输的稳定性。
移动端的推流工具可以使集成直播推流SDK进行开发。视频流推送至阿里云直播中心后，可按需对视频流进行转码，录制，截图，安全审核等处理。
处理好的视频流通过CDN内容分发网络下发至观众的设备中进行播放。移动端的播放设备可通过播放器SDK进行开发。
直播视频除了可以进行转码截图等操作外，还可以进行直播转点播的操作，将录制下来的视频转至点播系统中再进行点播播放。

详细步骤
　  1.采集
采集是播放环节中的第一环，iOS 系统因为软硬件种类不多，硬件适配性较好，所以比较简单。Android 则不同，市面上硬件机型非常多，难以做到一个库适配所有硬件。PC 端的采集也跟各种摄像头驱动有关，推荐使用目前市面上最好用的 PC 端开源免费软件 OBS。

　　2.处理
「80% 的主播没有美颜根本没法看。」不光是美颜，很多其它的视频处理如模糊效果、水印等也都是在这个环节做。目前 iOS 端比较知名的是 GPUImage 这个库，提供了丰富端预处理效果，还可以基于这个库自己写算法实现更丰富端效果。Android 也有 GPUImage 这个库的移植，叫做 android-gpuimage。同时，Google 官方开源了一个伟大的库，覆盖了 Android 上面很多多媒体和图形图像相关的处理。

　　3.编码
编码主要难点有两个：1. 处理硬件兼容性问题。2. 在高 fps、低 bitrate 和音质画质之间找到平衡。iOS 端硬件兼容性较好，可以直接采用硬编。而 Android 的硬编的支持则难得多，需要支持各种硬件机型，推荐使用软编。

　　4.推流和传输
传输涉及到很多端：从主播端到服务端，从收流服务端到边缘节点，以及再从边缘节点到观众端。
推流端和分发端理论上需要支持的并发用户数应该都是亿级的，不过毕竟产生内容的推流端在少数，和消费内容端播放端不是一个量级，但是他们对推流稳定性和速度的要求比播放端高很多，这涉及到所有播放端能否看到直播，以及直播端质量如何。
借助 CDN 快速实现大规模的流分发，但是稳定高速的推流上传可能还需要自己做很多工作。

　　5.转码
为了让主播推上来的流适配各个平台端各种不同协议，需要在服务端做一些流处理工作，比如转码成不同格式支持不同协议如 RTMP、HLS 和 FLV，一路转多路流来适配各种不同的网络状况和不同分辨率的终端设备。

　　6.解码和渲染
解码和渲染，也即音视频的播放，目前 iOS 端的播放兼容性较好，在延迟可接受的情况下使用 HLS 协议是最好的选择，我们也提供了能够播放 RTMP 和 HLS 的播放器 SDK。Android 的硬件解码和编码一样也存在兼容性问题，目前比较好的开源播放器是基于 ffplay 的 ijkplayer。


　　7.直播场景化解决方案
互动系统（聊天室、礼物系统、赞）
除了整个直播流程的介绍之外，我们将围绕当下最火的直播场景如社交直播和游戏直播，介绍它背后的技术方案。这些技术方案不仅涉及到七牛这样的直播基础服务，还可能涉及到和场景相关的其它技术，如社交直播下的聊天、点赞和弹幕的支持


IM(InstantMessaging)即时通讯：是一个实时通信系统，允许两人或多人使用网络实时的传递文字消息、文件、语音与视频交流。IM在直播系统中的主要作用是实现观众与主播、观众与观众之间的文字互动。


------------------------------------------------------------------------------------------
（3）电商直播技术及内容现状和问题

现状：
（1）聊天

私聊、聊天室、点赞、推送、黑名单等;

（2）礼物

普通礼物、豪华礼物、红包、排行榜、第三方充值、内购、礼物动态更新、提现等；

（3）直播列表

关注、热门、最新、分类直播用户列表等；

（4）自己直播

录制、推流、解码、播放、美颜、心跳、后台切换、主播对管理员操作、管理员对用户等；

（5）房间逻辑

创建房间、进入房间、退出房间、关闭房间、切换房间、房间管理员设置、房间用户列表等；

（6）用户逻辑

普通登陆、第三方登陆、注册、搜索、修改个人信息、关注列表、粉丝列表、忘记密码、查看个人信息、收入榜、关注和取
关、检索等；

（7）观看直播

聊天信息、滚屏弹幕、礼物显示、加载界面等；

（8）统计

业务统计、第三方统计等；

（9）超级管理员

禁播、隐藏、审核等；


问题：

直播延迟高:
直播行业大火，大家可以在日常生活中接触到各类直播，例如游戏直播、乐秀、在线教育、发布会等等。无论哪种类型的直
播，延时是直播过程中需要关注的一个重要的点。直播实现低延迟，是对大部分直播产品的要求，低延迟也是提升直播产品
用户体验最有效的一个方法，特别是对于互动直播、在线教育这一类产品来说。

互动玩法与画面不同步：
在直播应用的开发过程中，如果把主播端消息事件传递到观众端，一般会以Instant Messaging（即时通讯）的方式传递过去，但因为消息分发通道和直播通道是分开的，因此消息与直播音视频数据的同步性就会出现很多问题。


------------------------------------------------------------------------------------------

建议


（一）、直播延迟高:

视频直播主要涉及到采集、预处理、编码、传输、服务器转码、解码这样的流程。而延迟可以理解为几个关键延迟成分的集合：处理延迟、传输延迟和传播延迟。处理延迟是指系统对数据包报头进行分析和确定数据包被发送到哪里去所要花费的时间。传输延迟是指将包中的数据位传入线路所需要的时间。根据数据包的大小和带宽的不同而有所变化。但并不取决于传输线路的距离，而传播延迟是指数据包的第一个比特位从发送端到达接收端的时间。通常也被称为距离的延迟，受数据传输距离和传播速度的影响。

1、直播协议选择
目前国内比较常见的三种直播协议 RTMP、HLS、HTTP-FLV，下面来简单介绍下。RTMP 是专为流媒体开发的协议，对底层的优化比其它协议更加优秀，同时它 Adobe Flash 支持好，基本上所有的编码器（摄像头之类）都支持 RTMP 输出。现在 PC 市场巨大，PC 主要是 Windows，Windows 的浏览器基本上都支持 Flash。另外 RTMP 适合长时间播放，曾经有过测试，连续 100 万秒，即 10 天多连续播放没有出现问题。最后 RTMP 的延迟相对较低，一般延时在 1-3s 之间，一般的视频会议，互动式直播，完全是够用的。

当然 RTMP 并没有尽善尽美，它也有不足的地方。一方面是它是基于 TCP 传输，非公共端口，可能会被防火墙阻拦；另一方面，也是比较坑的一方面是 RTMP 为 Adobe 私有协议，很多设备无法播放，特别是在 iOS 端，需要使用第三方解码器才能播放。

HLS 是由苹果公司提出的基于 HTTP 的流媒体网络传输协议。是苹果公司 QuickTime X 和 iPhone 软件系统的一部分。主要应用于 iOS 设备，包含(iPhone, iPad, iPod touch) 以及 Mac OSX 提供音视频直播服务和录制内容（点播）等服务。它的工作原理是把整个流分成一个个小的基于 HTTP 的文件来下载，每次只下载一些。当媒体流正在播放时，客户端可以选择从许多不同的备用源中以不同的速率下载同样的资源，允许流媒体会话适应不同的数据速率。性能高，可以通过 CDN 进行网络分发。

而 HLS 的劣势也非常明显，首先 HLS 实时性差，延迟高，HLS 的延迟基本在 10s+ 以上。另外由于 HLS 请求的并不是完整的数据流，导致它产生文件碎片多。ts 切片较小，会造成海量小文件，对存储和缓存都有一定的挑战。

FLV是一种在网络上传输的流媒体数据存储容器格式。而我们所说的 HTTP-FLV 即将流媒体数据封装成 FLV 格式，然后通过 HTTP 协议传输给客户端。HTTP-FLV 能够好的穿透防火墙，它是基于 HTTP/80 传输，有效避免被防火墙拦截。另外，它可以通过 HTTP 302 跳转灵活调度/负载均衡，支持使用 HTTPS 加密传输，也能够兼容支持 Android，iOS 的移动端。FLV 也有一个缺点，由于它的传输特性，会让流媒体资源缓存在本地客户端，在保密性方面不够好。

在不同的直播场景中，选用合适的直播协议，能大大降低直播的延迟。


2、细节优化，减少延迟
智能调度:
国内的 DNS 相比较来说污染是很严重的，可能会把 DNS 解析到错误的节点上去，而 HTTP-DNS 可以进行精准调度；另外可以有效防止劫持绕过运营商的 Local DNS，避免域名劫持，访问更流畅；0ms 解析延迟，通过热点域名与解析，缓存 DNS 解析结果；稳定可靠，解析更加快。
码率选择:
日常比较常见的直播码率有流畅、标清、高清，部分平台也提供了超清的播放码率。这涉及到直播转码的策略，提供多种码率让用户可以实际去选择。多种码率的适配对于客户端网络不稳定的情况可以降低延时，这能够让用户有更好的观看直播体验。


（二）互动玩法与画面不同步：

那么有没有在音视频内部传递消息的方法呢？答案是SEI。
补充增强信息（Supplemental Enhancement Information）是码流范畴里面的概念，提供了向视频码流中加入信息的办法，是H.264/H.265 视频压缩标准的特性之一。SEI 有基本的特征：

并不是解码过程的必须项；
有可能对解码过程（容错、纠错）有帮助；
集成在视频码流中；
这意味着视频编码器在输出视频码流的时候，可以不提供SEI信息 。同时我们也要清楚：视频传输过程、解封装、解码环节，都可能因为某种原因丢弃SEI 。

在视频内容的生成端、传输过程中，都可以插入SEI 信息。插入的信息，和其他视频内容一起经过传输链路到达了消费端。那么在SEI 中可以添加哪些信息呢？这里举几个例子，用户场景可以任意扩展：

传递编码器参数；
传递视频版权信息;
传递摄像头参数；
传递内容生成过程中的剪辑事件（引发场景切换）；

------------------------------------------------------------------------------------------

总结：
线上购物的体验形式必将逐渐向成熟的线下场景靠近；而随着投入商用的 5G 网络普及以及未来 VR 、AR 等技术的逐渐成熟，线上购物体验将远远超越过去传统的超市货架式电商，向真正的"云逛街"逐渐接近。

进店沟通：
过去：商品详情页跳转售前客服阿里旺旺文字聊天："亲，有什么可以帮您？"
未来：商品详情页跳转客服视频直播："亲，这条裙子搭配外套更显瘦哦！"

选品比较：
过去：看李佳琦将套装口红 10 个色号涂满手臂作比较；
未来：线上 AR 试妆，自由选取 10 个色号看效果；

产品溯源：
过去：薇娅滔滔不绝 5 分钟详细讲解某品牌奶制品原产地品控质量；
未来：随时进店铺直播间观看牛奶工厂各环节实时生产情况；

双线融合：
过去：二三线城市用户定期前往一线城市顶级商圈"买买买"；
未来：通过 VR/AR 技术二三线用户在家即可逛完各大一线城市顶级商圈；


